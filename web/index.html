<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校园绿色物品共享与循环交易系统</title>
    <link rel="stylesheet" href="static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-recycle"></i>
                <span>绿色校园交易</span>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="#home" class="nav-link" onclick="showSection('home')">首页</a>
                <a href="#items" class="nav-link" onclick="showSection('items')">物品浏览</a>
                <a href="#publish" class="nav-link" onclick="showSection('publish')">发布物品</a>
                <a href="#myitems" class="nav-link" onclick="showSection('myitems')">我的物品</a>
                <a href="#transactions" class="nav-link" onclick="showSection('transactions')">我的交易</a>
                <a href="#favorites" class="nav-link" onclick="showSection('favorites')">我的收藏</a>
                <a href="#profile" class="nav-link" onclick="showSection('profile')">个人中心</a>
            </div>
            <div class="nav-auth" id="navAuth">
                <button class="btn btn-primary" onclick="showLoginModal()">登录</button>
                <button class="btn btn-secondary" onclick="showRegisterModal()">注册</button>
            </div>
            <div class="nav-user" id="navUser" style="display: none;">
                <span id="userInfo"></span>
                <button class="btn btn-outline" onclick="logout()">退出</button>
            </div>
            <div class="nav-toggle" onclick="toggleNav()">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <main class="main-content">
        <!-- 首页 -->
        <section id="home" class="section active">
            <div class="hero">
                <div class="hero-content">
                    <h1>校园绿色物品共享与循环交易系统</h1>
                    <p>低碳循环，资源共享，让闲置物品重新焕发生机</p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <i class="fas fa-users"></i>
                            <span id="userCount">0</span>
                            <span>注册用户</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-box"></i>
                            <span id="itemCount">0</span>
                            <span>物品总数</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-handshake"></i>
                            <span id="transactionCount">0</span>
                            <span>交易总数</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="features">
                <h2>系统特色</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <i class="fas fa-leaf"></i>
                        <h3>绿色环保</h3>
                        <p>促进闲置物品的循环利用，减少资源浪费</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-graduation-cap"></i>
                        <h3>校园特色</h3>
                        <p>专为校园环境设计，支持学号验证</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-star"></i>
                        <h3>信誉系统</h3>
                        <p>建立用户信誉评分机制，保障交易安全</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-shield-alt"></i>
                        <h3>数据安全</h3>
                        <p>自动保存用户数据，支持系统重启后数据恢复</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 物品浏览 -->
        <section id="items" class="section">
            <div class="section-header">
                <h2>物品浏览</h2>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="搜索物品...">
                    <button onclick="searchItems()"><i class="fas fa-search"></i></button>
                </div>
            </div>
            
            <div class="filter-bar">
                <div class="filter-group">
                    <label>类别筛选:</label>
                    <select id="categoryFilter" onchange="filterItems()">
                        <option value="">所有类别</option>
                        <option value="0">书籍</option>
                        <option value="1">电子产品</option>
                        <option value="2">服装</option>
                        <option value="3">运动器材</option>
                        <option value="4">日用品</option>
                        <option value="5">其他</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>价格区间:</label>
                    <input type="number" id="minPriceFilter" placeholder="最低价格" onchange="filterItems()">
                    <span>-</span>
                    <input type="number" id="maxPriceFilter" placeholder="最高价格" onchange="filterItems()">
                </div>
                
                <div class="filter-group">
                    <label>发布时间:</label>
                    <select id="timeFilter" onchange="filterItems()">
                        <option value="">所有时间</option>
                        <option value="today">今天</option>
                        <option value="week">本周</option>
                        <option value="month">本月</option>
                        <option value="3months">近3个月</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>状态筛选:</label>
                    <select id="statusFilter" onchange="filterItems()">
                        <option value="">所有状态</option>
                        <option value="0">可交易</option>
                        <option value="1">已预订</option>
                        <option value="2">已售出</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <button class="btn btn-secondary" onclick="clearFilters()">清除筛选</button>
                </div>
            </div>
            
            <div class="items-grid" id="itemsGrid">
                <!-- 物品卡片将通过JavaScript动态加载 -->
            </div>
        </section>

        <!-- 发布物品 -->
        <section id="publish" class="section">
            <div class="section-header">
                <h2>发布物品</h2>
            </div>
            
            <div class="form-container">
                <form id="publishForm" onsubmit="publishItem(event)">
                    <div class="form-group">
                        <label for="itemTitle">物品标题 *</label>
                        <input type="text" id="itemTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemDescription">物品描述 *</label>
                        <textarea id="itemDescription" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemPrice">价格 (元) *</label>
                            <input type="number" id="itemPrice" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="itemCategory">物品类别 *</label>
                            <select id="itemCategory" required>
                                <option value="">请选择类别</option>
                                <option value="0">书籍</option>
                                <option value="1">电子产品</option>
                                <option value="2">服装</option>
                                <option value="3">运动器材</option>
                                <option value="4">日用品</option>
                                <option value="5">其他</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemCondition">使用情况 *</label>
                        <input type="text" id="itemCondition" placeholder="如：全新、九成新等" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemImage">上传图片</label>
                        <input type="file" id="itemImage" accept="image/*">
                        <small style="color: #6c757d;">可选，支持 jpg、png、gif 格式</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-large">发布物品</button>
                </form>
            </div>
        </section>

        <!-- 我的物品 -->
        <section id="myitems" class="section">
            <div class="section-header">
                <h2>我的物品</h2>
                <button class="btn btn-primary" onclick="showSection('publish')">发布新物品</button>
            </div>
            
            <div class="my-items-container">
                <div class="items-stats">
                    <div class="stat-item">
                        <span class="stat-label">总发布:</span>
                        <span id="totalItemsCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">可交易:</span>
                        <span id="availableItemsCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">已预订:</span>
                        <span id="reservedItemsCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">已售出:</span>
                        <span id="soldItemsCount">0</span>
                    </div>
                </div>
                
                <div class="items-grid" id="myItemsGrid">
                    <!-- 我的物品将通过JavaScript动态加载 -->
                </div>
            </div>
        </section>

        <!-- 我的交易 -->
        <section id="transactions" class="section">
            <div class="section-header">
                <h2>我的交易</h2>
            </div>
            
            <div class="transactions-list" id="transactionsList">
                <!-- 交易列表将通过JavaScript动态加载 -->
            </div>
        </section>

        <!-- 我的收藏 -->
        <section id="favorites" class="section">
            <div class="section-header">
                <h2>我的收藏</h2>
            </div>
            
            <div class="items-grid" id="favoritesGrid">
                <!-- 收藏物品将通过JavaScript动态加载 -->
            </div>
        </section>

        <!-- 个人中心 -->
        <section id="profile" class="section">
            <div class="section-header">
                <h2>个人中心</h2>
            </div>
            
            <div class="profile-container">
                <div class="profile-info" id="profileInfo">
                    <!-- 用户信息将通过JavaScript动态加载 -->
                </div>
                
                <div class="profile-stats">
                    <h3>我的统计</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-box"></i>
                            <span id="myItemCount">0</span>
                            <span>发布物品</span>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-handshake"></i>
                            <span id="myTransactionCount">0</span>
                            <span>交易记录</span>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-heart"></i>
                            <span id="myFavoriteCount">0</span>
                            <span>收藏物品</span>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-star"></i>
                            <span id="myCreditScore">0</span>
                            <span>信誉评分</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 登录模态框 -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户登录</h3>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <form id="loginForm" onsubmit="login(event)">
                <div class="form-group">
                    <label for="loginUsername">用户名</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">密码</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary btn-large">登录</button>
            </form>
        </div>
    </div>

    <!-- 注册模态框 -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户注册</h3>
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
            </div>
            <form id="registerForm" onsubmit="register(event)">
                <div class="form-group">
                    <label for="registerUsername">用户名</label>
                    <input type="text" id="registerUsername" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">密码</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">邮箱</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">电话</label>
                    <input type="tel" id="registerPhone" required>
                </div>
                <div class="form-group">
                    <label for="registerStudentId">学号</label>
                    <input type="text" id="registerStudentId" required>
                </div>
                <button type="submit" class="btn btn-primary btn-large">注册</button>
            </form>
        </div>
    </div>

    <!-- 物品详情模态框 -->
    <div id="itemModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="itemModalTitle">物品详情</h3>
                <span class="close" onclick="closeModal('itemModal')">&times;</span>
            </div>
            <div id="itemModalContent">
                <!-- 物品详情内容将通过JavaScript动态加载 -->
            </div>
        </div>
    </div>

    <!-- 交易详情模态框 -->
    <div id="transactionModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="transactionModalTitle">交易详情</h3>
                <span class="close" onclick="closeModal('transactionModal')">&times;</span>
            </div>
            <div id="transactionModalContent">
                <!-- 交易详情内容将通过JavaScript动态加载 -->
            </div>
        </div>
    </div>

    <!-- 修改物品模态框 -->
    <div id="editItemModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>修改物品信息</h3>
                <span class="close" onclick="closeModal('editItemModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editItemForm" onsubmit="updateItem(event)">
                    <div class="form-group">
                        <label for="editItemTitle">物品标题 *</label>
                        <input type="text" id="editItemTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editItemDescription">物品描述 *</label>
                        <textarea id="editItemDescription" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editItemPrice">价格 (元) *</label>
                            <input type="number" id="editItemPrice" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editItemCategory">物品类别 *</label>
                            <select id="editItemCategory" required>
                                <option value="0">书籍</option>
                                <option value="1">电子产品</option>
                                <option value="2">服装</option>
                                <option value="3">运动器材</option>
                                <option value="4">日用品</option>
                                <option value="5">其他</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editItemCondition">使用情况 *</label>
                        <input type="text" id="editItemCondition" placeholder="如：全新、九成新等" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editItemImage">上传新图片</label>
                        <input type="file" id="editItemImage" accept="image/*">
                        <small style="color: #6c757d;">可选，不选择则保留原图片</small>
                        <input type="hidden" id="editItemImagePath">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">保存修改</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('editItemModal')">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 留言模态框 -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>交易留言</h3>
                <span class="close" onclick="closeModal('messageModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="message-info">
                    <p><strong>交易编号：</strong><span id="messageTransactionId"></span></p>
                    <p><strong>物品名称：</strong><span id="messageItemTitle"></span></p>
                    <p><strong>对方用户：</strong><span id="messageOtherUser"></span></p>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <!-- 消息列表将通过JavaScript动态加载 -->
                </div>
                
                <div class="message-input-container">
                    <textarea id="messageInput" placeholder="输入留言内容..." rows="3"></textarea>
                    <button class="btn btn-primary" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i> 发送
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 消息提示 -->
    <div id="messageToast" class="toast">
        <span id="messageText"></span>
    </div>

    <script src="static/js/app.js"></script>
</body>
</html>
